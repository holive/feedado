package rss

import (
	"context"
	"net/http"
	netHttp "net/http"
	"net/http/httptest"
	"testing"

	"github.com/stretchr/testify/assert"

	"github.com/holive/feedado/app/feed"
	"github.com/stretchr/testify/require"
	"go.uber.org/zap"
)

func initLoggerTest() *zap.SugaredLogger {
	logger, _ := zap.NewProduction()
	return logger.Sugar()
}

type UpdaterTest struct {
}

type SchemaGetterTest struct {
}

func (u *UpdaterTest) Create(ctx context.Context, feeds []*RSS) error {
	return nil
}

func (s *SchemaGetterTest) Find(ctx context.Context, id string) (*feed.Feed, error) {
	return nil, nil
}

func TestProcessor_fetchRssResults(t *testing.T) {
	testServer := httptest.NewServer(http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {
		res.Header().Add("Content-Type", "text/html")
		res.Write([]byte("\n<!DOCTYPE html><html lang=\"pt-BR\"><head></head><body> </div><section class=\"container editorial economia\"> <div class=\"row\"> <section class=\"col-md-12 col-sm-12 col-xs-12 content\"> <div class=\"row\"> <section class=\"col-md-8 col-sm-12 col-xs-12 content\"> <div class=\"row management\"> <section class=\"block-saiba-agora-0 full-foto col-md-12 col-sm-12 col-xs-12 init foto-full \"> <div class=\"box \"> <div class=\"figure-wrapper\"> <div class=\"label\"> <h4> <a href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\" class=\"cor-e\">Quest&atilde;o ambiental</a> </h4> <ul class=\"share \"> <li class=\"hidden\"> <a href=\"javascript:void(0);\" class=\"balloon comentarios-balaozinho\" data-ancora='noticia_1' title=\"Comentários\"> </a> </li><li class=\"facebook \"> <a href=\"https://www.facebook.com/sharer/sharer.php?u=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Afacebook%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-facebook\" title=\"Compartilhe pelo Facebook\">&nbsp;</a> </li><li class=\"whatsapp \"> <a href=\"whatsapp://send?text=Bolsonaro+diz+que+a+imagem+do+Brasil+no+exterior+%27n%26atilde%3Bo+est%26aacute%3B+muito+boa%27%2C+mas+atribui+a+%27desinforma%26ccedil%3B%26atilde%3Bo%27%20Estad%C3%A3o%3A%20https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Awhatsapp%26utm_medium%3Dlink\" class=\"ico-whatsapp\" title=\"Compartilhe pelo WhatsApp\">&nbsp;</a> </li><li class=\"twitter \"> <a href=\"https://twitter.com/intent/tweet?text=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\" title=\"Compartilhe pelo Twitter\">&nbsp;</a> </li><li class=\"other \"> <a href=\"javascript:void(0);\" class=\"ico-dots-three-horizontal \" title=\"Mais compartilhamentos\" data-href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\" data-title=\"Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'\">&nbsp;</a> <div class=\"share-more\"> <div class=\"share-total\" data-url=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\"> </div><ul> <li class=\"twitter\"> <a href=\"https://twitter.com/intent/tweet?text=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\"> <span>twitter</span> </a> </li><li class=\"linkedin\"> <a href=\"https://www.linkedin.com/cws/share?url=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Alinkedin%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-linkedin\"> <span>linkedin</span> </a> </li><li class=\"email\"> <a href=\"mailto:?subject=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'&amp;body=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o' - https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Amail%26utm_medium%3Dlink\" class=\"ico-envelope-o\"> <span>e-mail</span> </a> </li><li class=\"print\"> <a href=\"javascript:window.print();\" class=\"ico-printer-text\"> <span>imprimir</span> </a> </li></ul> </div></li></ul> </div></div><div class=\"text-wrapper\"> <a href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\"> <h3> Bolsonaro diz que a imagem do Brasil no exterior &#039;n&atilde;o est&aacute; muito boa&#039;, mas atribui a &#039;desinforma&ccedil;&atilde;o&#039; </h3> </a> <a href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\"> <p>Presidente afirmou que Pa&iacute;s fecha contratos semanalmente na &aacute;rea do agroneg&oacute;cio e j&aacute; recupera confian&ccedil;a </p></a> </div></div></section><section class=\"block-saiba-agora-0 full-foto col-md-12 col-sm-12 col-xs-12 init foto-full \"> <div class=\"box \"> <div class=\"figure-wrapper\"> <div class=\"label\"> <h4> <a href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\" class=\"cor-e\">Quest&atilde;o ambiental</a> </h4> <ul class=\"share \"> <li class=\"hidden\"> <a href=\"javascript:void(0);\" class=\"balloon comentarios-balaozinho\" data-ancora='noticia_1' title=\"Comentários\"> </a> </li><li class=\"facebook \"> <a href=\"https://www.facebook.com/sharer/sharer.php?u=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Afacebook%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-facebook\" title=\"Compartilhe pelo Facebook\">&nbsp;</a> </li><li class=\"whatsapp \"> <a href=\"whatsapp://send?text=Bolsonaro+diz+que+a+imagem+do+Brasil+no+exterior+%27n%26atilde%3Bo+est%26aacute%3B+muito+boa%27%2C+mas+atribui+a+%27desinforma%26ccedil%3B%26atilde%3Bo%27%20Estad%C3%A3o%3A%20https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Awhatsapp%26utm_medium%3Dlink\" class=\"ico-whatsapp\" title=\"Compartilhe pelo WhatsApp\">&nbsp;</a> </li><li class=\"twitter \"> <a href=\"https://twitter.com/intent/tweet?text=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\" title=\"Compartilhe pelo Twitter\">&nbsp;</a> </li><li class=\"other \"> <a href=\"javascript:void(0);\" class=\"ico-dots-three-horizontal \" title=\"Mais compartilhamentos\" data-href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\" data-title=\"Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'\">&nbsp;</a> <div class=\"share-more\"> <div class=\"share-total\" data-url=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\"> </div><ul> <li class=\"twitter\"> <a href=\"https://twitter.com/intent/tweet?text=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\"> <span>twitter</span> </a> </li><li class=\"linkedin\"> <a href=\"https://www.linkedin.com/cws/share?url=https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Alinkedin%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-linkedin\"> <span>linkedin</span> </a> </li><li class=\"email\"> <a href=\"mailto:?subject=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o'&amp;body=Bolsonaro diz que a imagem do Brasil no exterior 'n&atilde;o est&aacute; muito boa', mas atribui a 'desinforma&ccedil;&atilde;o' - https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052%3Futm_source%3Destadao%3Amail%26utm_medium%3Dlink\" class=\"ico-envelope-o\"> <span>e-mail</span> </a> </li><li class=\"print\"> <a href=\"javascript:window.print();\" class=\"ico-printer-text\"> <span>imprimir</span> </a> </li></ul> </div></li></ul> </div></div><div class=\"text-wrapper\"> <a href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\"> <h3> Bolsonaro diz que a imagem do Brasil no exterior &#039;n&atilde;o est&aacute; muito boa&#039;, mas atribui a &#039;desinforma&ccedil;&atilde;o&#039; </h3> </a> <a href=\"https://economia.estadao.com.br/noticias/agronegocios,sabemos-que-nossa-imagem-nao-esta-muito-boa-no-exterior-na-questao-ambiental-diz-bolsonaro,70003341052\"> <p>Presidente afirmou que Pa&iacute;s fecha contratos semanalmente na &aacute;rea do agroneg&oacute;cio e j&aacute; recupera confian&ccedil;a </p></a> </div></div></section> <section class=\"block-saiba-agora-1 full-foto-lateral col-md-12 col-sm-12 col-xs-12 custom-news init \"> <div class=\"row\"> <section class=\"col-md-6 col-sm-6 col-xs-12\"> <div class=\"box \"> <div class=\"label\"> <h4> <a href=\"https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730\" class=\"cor-e\"> MERCADO </a> </h4> <ul class=\"share \"> <li class=\"hidden\"> <a href=\"javascript:void(0);\" class=\"balloon comentarios-balaozinho\" data-ancora='noticia_1' title=\"Comentários\"> </a> </li><li class=\"facebook \"> <a href=\"https://www.facebook.com/sharer/sharer.php?u=https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730%3Futm_source%3Destadao%3Afacebook%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-facebook\" title=\"Compartilhe pelo Facebook\">&nbsp;</a> </li><li class=\"whatsapp \"> <a href=\"whatsapp://send?text=Bolsa+perde+a+estabilidade+e+fecha+com+queda+de+1%25%3B+d%26oacute%3Blar+recua+e+fica+a+R%24+5%2C27%20Estad%C3%A3o%3A%20https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730%3Futm_source%3Destadao%3Awhatsapp%26utm_medium%3Dlink\" class=\"ico-whatsapp\" title=\"Compartilhe pelo WhatsApp\">&nbsp;</a> </li><li class=\"twitter \"> <a href=\"https://twitter.com/intent/tweet?text=Bolsa perde a estabilidade e fecha com queda de 1%; d&oacute;lar recua e fica a R$ 5,27%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\" title=\"Compartilhe pelo Twitter\">&nbsp;</a> </li><li class=\"other \"> <a href=\"javascript:void(0);\" class=\"ico-dots-three-horizontal \" title=\"Mais compartilhamentos\" data-href=\"https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730\" data-title=\"Bolsa perde a estabilidade e fecha com queda de 1%; d&oacute;lar recua e fica a R$ 5,27\">&nbsp;</a> <div class=\"share-more\"> <div class=\"share-total\" data-url=\"https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730\"> </div><ul> <li class=\"twitter\"> <a href=\"https://twitter.com/intent/tweet?text=Bolsa perde a estabilidade e fecha com queda de 1%; d&oacute;lar recua e fica a R$ 5,27%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\"> <span>twitter</span> </a> </li><li class=\"linkedin\"> <a href=\"https://www.linkedin.com/cws/share?url=https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730%3Futm_source%3Destadao%3Alinkedin%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-linkedin\"> <span>linkedin</span> </a> </li><li class=\"email\"> <a href=\"mailto:?subject=Bolsa perde a estabilidade e fecha com queda de 1%; d&oacute;lar recua e fica a R$ 5,27&amp;body=Bolsa perde a estabilidade e fecha com queda de 1%; d&oacute;lar recua e fica a R$ 5,27 - https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730%3Futm_source%3Destadao%3Amail%26utm_medium%3Dlink\" class=\"ico-envelope-o\"> <span>e-mail</span> </a> </li><li class=\"print\"> <a href=\"javascript:window.print();\" class=\"ico-printer-text\"> <span>imprimir</span> </a> </li></ul> </div></li></ul> </div><figure class=\" \"> <a href=\"https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730\"> <img class=\"elazy\" data-src-desktop=\"https://img.estadao.com.br/fotos/crop/356x199/fotos3/750x423/Painel_da_Bolsa_de_Valores_B3_Foto_Renato_Cerqueira_Futura_Press.jpg\" data-src-mobile=\"https://img.estadao.com.br/fotos/crop/356x199/fotos3/750x423/Painel_da_Bolsa_de_Valores_B3_Foto_Renato_Cerqueira_Futura_Press.jpg\" alt=\"Mercado brasileiro j&aacute; sente a tens&atilde;o de uma poss&iacute;vel segunda onda de casos da covid-19 no mundo. Foto: Renato Cerqueira/Futura Press\" title=\"Mercado brasileiro j&aacute; sente a tens&atilde;o de uma poss&iacute;vel segunda onda de casos da covid-19 no mundo. Foto: Renato Cerqueira/Futura Press\"/> </a> </figure> </div></section> <section class=\"col-md-6 col-sm-6 col-xs-12 foto-lateral-destaque-box\"> <div class=\"box \"> <div class=\"text-wrapper\"> <a href=\"https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730\"> <h3 class=\"third\"> Bolsa perde a estabilidade e fecha com queda de 1%; d&oacute;lar recua e fica a R$ 5,27 </h3> </a> <a href=\"https://economia.estadao.com.br/noticias/geral,dolar-inicia-negociacoes-em-queda-cotado-abaixo-de-r-5-30,70003340730\"> <p>Poss&iacute;vel segunda onda da covid-19 pressionou o &iacute;ndice, que caiu mesmo com a alta em Nova York</p></a> </div><ul class=\"list-news\"> <li class=\"\"> <a href=\"https://economia.estadao.com.br/noticias/geral,mercados-internacionais-tem-queda-nesta-segunda-com-avanco-de-covid-19-no-radar,70003340672\">Mercados internacionais fecham sem sentido &uacute;nico, com avan&ccedil;o de covid-19 no radar</a> </li></ul> <div class=\"selo-patrocinio\"> <sup class=\"lbl-sponsor\">Oferecimento</sup> <div class=\"adsense patrocinio-interna\"> <div id='selo-0' class='publicidade dfp' data-screenmap='out_of_page' data-target='{\"formato\":\"selo\",\"titulo_caixa\":\"patrocinio-interna\",\"page_url\":\"economia.estadao.com.br,\",\"pg_tipo\":null,\"tags\":false}' data-status='init' data-no-depara='1'></div></div></div></div></section> </div></section> <section class=\"block-saiba-agora-2 col-md-6 col-sm-6 col-xs-12 init half-foto \"> <div class=\"box \"> <div class=\"label\"> <h4> <a href=\"https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076\" class=\"cor-e\"> Aux&iacute;lio emergencial </a> </h4> <ul class=\"share \"> <li class=\"hidden\"> <a href=\"javascript:void(0);\" class=\"balloon comentarios-balaozinho\" data-ancora='noticia_1' title=\"Comentários\"> </a> </li><li class=\"facebook \"> <a href=\"https://www.facebook.com/sharer/sharer.php?u=https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076%3Futm_source%3Destadao%3Afacebook%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-facebook\" title=\"Compartilhe pelo Facebook\">&nbsp;</a> </li><li class=\"whatsapp \"> <a href=\"whatsapp://send?text=Bolsonaro%3A+%27Governo+n%26atilde%3Bo+vai+suportar+mais+duas+parcelas+de+R%24+600%27%20Estad%C3%A3o%3A%20https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076%3Futm_source%3Destadao%3Awhatsapp%26utm_medium%3Dlink\" class=\"ico-whatsapp\" title=\"Compartilhe pelo WhatsApp\">&nbsp;</a> </li><li class=\"twitter \"> <a href=\"https://twitter.com/intent/tweet?text=Bolsonaro: 'Governo n&atilde;o vai suportar mais duas parcelas de R$ 600'%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\" title=\"Compartilhe pelo Twitter\">&nbsp;</a> </li><li class=\"other \"> <a href=\"javascript:void(0);\" class=\"ico-dots-three-horizontal \" title=\"Mais compartilhamentos\" data-href=\"https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076\" data-title=\"Bolsonaro: 'Governo n&atilde;o vai suportar mais duas parcelas de R$ 600'\">&nbsp;</a> <div class=\"share-more\"> <div class=\"share-total\" data-url=\"https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076\"> </div><ul> <li class=\"twitter\"> <a href=\"https://twitter.com/intent/tweet?text=Bolsonaro: 'Governo n&atilde;o vai suportar mais duas parcelas de R$ 600'%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\"> <span>twitter</span> </a> </li><li class=\"linkedin\"> <a href=\"https://www.linkedin.com/cws/share?url=https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076%3Futm_source%3Destadao%3Alinkedin%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-linkedin\"> <span>linkedin</span> </a> </li><li class=\"email\"> <a href=\"mailto:?subject=Bolsonaro: 'Governo n&atilde;o vai suportar mais duas parcelas de R$ 600'&amp;body=Bolsonaro: 'Governo n&atilde;o vai suportar mais duas parcelas de R$ 600' - https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076%3Futm_source%3Destadao%3Amail%26utm_medium%3Dlink\" class=\"ico-envelope-o\"> <span>e-mail</span> </a> </li><li class=\"print\"> <a href=\"javascript:window.print();\" class=\"ico-printer-text\"> <span>imprimir</span> </a> </li></ul> </div></li></ul> </div><figure class=\" \"> <a href=\"https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076\"> <img class=\"elazy\" data-src-desktop=\"https://img.estadao.com.br/fotos/crop/356x199/fotos3/750x423/jair_bolsonaro_foto_gabriela_bilo_17_6_2020.jpg\" data-src-mobile=\"https://img.estadao.com.br/fotos/crop/356x199/fotos3/750x423/jair_bolsonaro_foto_gabriela_bilo_17_6_2020.jpg\" alt=\"Para Bolsonaro, medidas de isolamento social tomadas pos Estados e munic&iacute;pios s&atilde;o &#039;um exagero&#039;. Foto: Gabriela Bil&oacute;/Estad&atilde;o - 17/6/2020\" title=\"Para Bolsonaro, medidas de isolamento social tomadas pos Estados e munic&iacute;pios s&atilde;o &#039;um exagero&#039;. Foto: Gabriela Bil&oacute;/Estad&atilde;o - 17/6/2020\"/> </a> </figure> <div class=\"text-wrapper\"> <a href=\"https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076\"> <h3> Bolsonaro: &#039;Governo n&atilde;o vai suportar mais duas parcelas de R$ 600&#039; </h3> </a> <a href=\"https://economia.estadao.com.br/noticias/geral,governo-nao-vai-suportar-mais-duas-parcelas-de-r-600-de-auxilio-emergencial-diz-bolsonaro,70003341076\"> <p>Segundo presidente, Guedes vai ampliar benef&iacute;cio, mas novo valor ser&aacute; negociado no Congresso</p></a> </div><ul class=\"list-news no-ellipsis\"> </ul> </div></section> <section class=\"block-saiba-agora-3 col-md-6 col-sm-6 col-xs-12 init half-foto \"> <div class=\"box \"> <div class=\"label\"> <h4> <a href=\"https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490\" class=\"cor-e\"> Desemprego </a> </h4> <ul class=\"share \"> <li class=\"hidden\"> <a href=\"javascript:void(0);\" class=\"balloon comentarios-balaozinho\" data-ancora='noticia_1' title=\"Comentários\"> </a> </li><li class=\"facebook \"> <a href=\"https://www.facebook.com/sharer/sharer.php?u=https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490%3Futm_source%3Destadao%3Afacebook%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-facebook\" title=\"Compartilhe pelo Facebook\">&nbsp;</a> </li><li class=\"whatsapp \"> <a href=\"whatsapp://send?text=Covid-19+tira+1%2C4+milh%26atilde%3Bo+do+mercado+de+trabalho+por+motivo+de+doen%26ccedil%3Ba%20Estad%C3%A3o%3A%20https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490%3Futm_source%3Destadao%3Awhatsapp%26utm_medium%3Dlink\" class=\"ico-whatsapp\" title=\"Compartilhe pelo WhatsApp\">&nbsp;</a> </li><li class=\"twitter \"> <a href=\"https://twitter.com/intent/tweet?text=Covid-19 tira 1,4 milh&atilde;o do mercado de trabalho por motivo de doen&ccedil;a%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\" title=\"Compartilhe pelo Twitter\">&nbsp;</a> </li><li class=\"other \"> <a href=\"javascript:void(0);\" class=\"ico-dots-three-horizontal \" title=\"Mais compartilhamentos\" data-href=\"https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490\" data-title=\"Covid-19 tira 1,4 milh&atilde;o do mercado de trabalho por motivo de doen&ccedil;a\">&nbsp;</a> <div class=\"share-more\"> <div class=\"share-total\" data-url=\"https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490\"> </div><ul> <li class=\"twitter\"> <a href=\"https://twitter.com/intent/tweet?text=Covid-19 tira 1,4 milh&atilde;o do mercado de trabalho por motivo de doen&ccedil;a%20@estadao%3A%20&amp;url=https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490%3Futm_source%3Destadao%3Atwitter%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-twitter\"> <span>twitter</span> </a> </li><li class=\"linkedin\"> <a href=\"https://www.linkedin.com/cws/share?url=https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490%3Futm_source%3Destadao%3Alinkedin%26utm_medium%3Dlink\" target=\"_blank\" class=\"ico-linkedin\"> <span>linkedin</span> </a> </li><li class=\"email\"> <a href=\"mailto:?subject=Covid-19 tira 1,4 milh&atilde;o do mercado de trabalho por motivo de doen&ccedil;a&amp;body=Covid-19 tira 1,4 milh&atilde;o do mercado de trabalho por motivo de doen&ccedil;a - https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490%3Futm_source%3Destadao%3Amail%26utm_medium%3Dlink\" class=\"ico-envelope-o\"> <span>e-mail</span> </a> </li><li class=\"print\"> <a href=\"javascript:window.print();\" class=\"ico-printer-text\"> <span>imprimir</span> </a> </li></ul> </div></li></ul> </div><figure class=\" \"> <a href=\"https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490\"> <img class=\"elazy\" data-src-desktop=\"https://img.estadao.com.br/fotos/crop/356x199/fotos3/750x423/alcides_ramos_da_silva_foto_felipe_rau.jpg\" data-src-mobile=\"https://img.estadao.com.br/fotos/crop/356x199/fotos3/750x423/alcides_ramos_da_silva_foto_felipe_rau.jpg\" alt=\"Alcides Ramos da Silva, desempregado que teve sintomas de Covid-19: suspeita impede busca de nova vaga Foto: Felipe Rau/Estad&atilde;o\" title=\"Alcides Ramos da Silva, desempregado que teve sintomas de Covid-19: suspeita impede busca de nova vaga Foto: Felipe Rau/Estad&atilde;o\"/> </a> </figure> <div class=\"text-wrapper\"> <a href=\"https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490\"> <h3> Covid-19 tira 1,4 milh&atilde;o do mercado de trabalho por motivo de doen&ccedil;a </h3> </a> <a href=\"https://economia.estadao.com.br/noticias/geral,covid-19-tira-1-4-milhao-do-mercado-de-trabalho-por-motivo-de-doenca,70003340490\"> <p>Para economistas, criar novas vagas de empregos ser&aacute; o desafio do Brasil no per&iacute;odo p&oacute;s-pandemia</p></a> </div><ul class=\"list-news no-ellipsis\"> </ul> </div></section> </div></section> </div></section> </div></section></body></html>"))
	}))
	defer func() { testServer.Close() }()
	req, err := http.NewRequest(http.MethodGet, testServer.URL, nil)
	assert.NoError(t, err)
	res, err := http.DefaultClient.Do(req)
	assert.NoError(t, err)

	logger := initLoggerTest()
	updater := UpdaterTest{}
	schemaGetter := SchemaGetterTest{}
	cfg := ProcessorConfig{UserAgent: "feedado-test"}
	runner := &netHttp.Client{}

	processor, err := NewProcessor(&updater, &cfg, runner, logger, &schemaGetter)
	require.NoError(t, err)

	rsss, err := processor.sourceResponseToRSS(res, &feed.Feed{
		Source:      "https://economia.estadao.com.br/",
		Description: "",
		Sections: []feed.Section{
			{
				SectionSelector:  ".row.management section",
				TitleSelector:    ".text-wrapper h3",
				SubtitleSelector: ".text-wrapper p",
				UrlSelector:      ".text-wrapper a",
			},
		},
	})
	require.NoError(t, err)
	assert.Equal(t, 4, len(rsss))
}
